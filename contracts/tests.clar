# START - PREP
(stx-transfer? u100 tx-sender 'ST1HTBVD3JG9C05J7HBJTHGR0GGW7KXW28M5JS8QE.stxswap)
# ::get_assets_maps
# ::set_tx_sender ST1J4G6RR643BCG8G8SR6M2D9Z9KXT2NJDRK3FBTK

# TEST
(contract-call? 'ST1HTBVD3JG9C05J7HBJTHGR0GGW7KXW28M5JS8QE.stxswap lockStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000001)
# hashvaluesbuf => 0x80ffce1fe791d11fc28430b2c60b09ff1ce84cccb8b147332968857a17762a80

# (contract-call? 'ST1HTBVD3JG9C05J7HBJTHGR0GGW7KXW28M5JS8QE.stxswap hashValuesbufpub 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000001)
# (ok 0x80ffce1fe791d11fc28430b2c60b09ff1ce84cccb8b147332968857a17762a80)

# (contract-call? .stxswap checkSwapIsLockedpub 0x80ffce1fe791d11fc28430b2c60b09ff1ce84cccb8b147332968857a17762a80)
# (ok true)

# (contract-call? .stxswap claimStx 0x01 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000001)
# (contract-call? 'ST1HTBVD3JG9C05J7HBJTHGR0GGW7KXW28M5JS8QE.stxswap claimStx 0x01 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000001)

# ::advance_chain_tip 2
# (contract-call? .stxswap refundStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000001)

# v7 testing
# (contract-call? .stxswap_v7 lockStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000001 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM)
# ::set_tx_sender ST1SJ3DTE5DN7X54YDH5D64R3BCB6A2AG2ZQ8YPD5
# (contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap_v7 refundStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000001)
# fail u1001
# ::advance_chain_tip 5
# (contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap_v7 refundStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000001)
# fail u1002
# ::set_tx_sender ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM
# (contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap_v7 refundStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000001)
# success u1008

# (contract-call? .stxswap_v7 lockStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000001 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM)
# ::set_tx_sender ST1SJ3DTE5DN7X54YDH5D64R3BCB6A2AG2ZQ8YPD5
# (contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap_v7 claimStx 0x01 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000001)
# fail u1002
# ::set_tx_sender ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM
# (contract-call? .stxswap_v7 claimStx 0x01 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000001)
# success

# v8 testing
(contract-call? .stxswap_v8 lockStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM)
(contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap_v8 refundStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# fail u1001 - blockheight not reached
::set_tx_sender ST1SJ3DTE5DN7X54YDH5D64R3BCB6A2AG2ZQ8YPD5
::advance_chain_tip 6
(contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap_v8 refundStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# fail u1002 - invalid refunder
::set_tx_sender ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM
(contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap_v8 refundStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# success u1008

(contract-call? .stxswap_v8 lockStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM)
::set_tx_sender ST1SJ3DTE5DN7X54YDH5D64R3BCB6A2AG2ZQ8YPD5
(contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap_v8 claimStx 0x01 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# fail u1002 - invalid claimer
::set_tx_sender ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM
(contract-call? .stxswap_v8 claimStx 0x01 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# success

(contract-call? .stxswap_v8 lockStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM)
::advance_chain_tip 6
(contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap_v8 claimStx 0x01 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# fail u1003 - claim blockheight passed
(contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap_v8 refundStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# success u1008


# v9 - trigger testing
(contract-call? .stxswap lockStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM)
(contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap refundStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# fail u1001 - blockheight not reached
::set_tx_sender ST1SJ3DTE5DN7X54YDH5D64R3BCB6A2AG2ZQ8YPD5
::advance_chain_tip 6
(contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap refundStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# fail u1002 - invalid refunder
::set_tx_sender ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM
(contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap refundStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# success u1008

(contract-call? .stxswap lockStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM)
::set_tx_sender ST1SJ3DTE5DN7X54YDH5D64R3BCB6A2AG2ZQ8YPD5
(contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap claimStx 0x01 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# fail u1002 - invalid claimer
::set_tx_sender ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM
(contract-call? .stxswap claimStx 0x01 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# success

(contract-call? .stxswap lockStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM)
::advance_chain_tip 6
(contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap claimStx 0x01 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# fail u1003 - claim blockheight passed
(contract-call? 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.stxswap refundStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005)
# success u1008

# triggerStx
(contract-call? .stxswap lockStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005 'ST1HTBVD3JG9C05J7HBJTHGR0GGW7KXW28M5JS8QE)
(contract-call? .triggerswap triggerStx 0x01 0x00000000000000000000000000000001 0x01 0x01 0x00000000000000000000000000000005 'ST1HTBVD3JG9C05J7HBJTHGR0GGW7KXW28M5JS8QE.nft 'ST1J4G6RR643BCG8G8SR6M2D9Z9KXT2NJDRK3FBTK)
::get_assets_maps

# user with no stx gets nft via triggerStx
(contract-call? .stxswap lockStx 0x4bf5122f344554c53bde2ebb8cd2b7e3d1600ad631c385a5d7cce23c7785459a 0x000000000000000000000000004C4B40 0x01 0x01 0x00000000000000000000000000000005 'ST2QXSK64YQX3CQPC530K79XWQ98XFAM9W3XKEH3N)
::set_tx_sender ST2QXSK64YQX3CQPC530K79XWQ98XFAM9W3XKEH3N
(contract-call? 'ST1HTBVD3JG9C05J7HBJTHGR0GGW7KXW28M5JS8QE.triggerswap triggerStx 0x01 0x000000000000000000000000004C4B40 0x01 0x01 0x00000000000000000000000000000005 'ST1HTBVD3JG9C05J7HBJTHGR0GGW7KXW28M5JS8QE.nft 'ST2QXSK64YQX3CQPC530K79XWQ98XFAM9W3XKEH3N)
::get_assets_maps


# v10 - triggerstacking testing
(contract-call? .stxswap lockStx 0x2fcd86acff5f98752ed6b3e08bd3140a998c7118671943e5c880295e7f1ce8ee u5000000 u58479 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM)
(contract-call? 'SP000000000000000000002Q6VF78.pox allow-contract-caller 'ST1PQHQKV0RJXZFY1DGX8MNSNYVE3VGZJSRTPGZGM.triggerswap none)
(contract-call? .triggerswap triggerStacking 0xf1a80649f14c7ab230ca007d4a729327e858c34650670c57b974feed92f63448 u5000000 'ST2507VNQZC9VBXM7X7KB4SF4QJDJRSWHG6ERHWB7 none)
# works! - allow-contract-caller important!